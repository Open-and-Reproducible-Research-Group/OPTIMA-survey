---
title: "Survey Analysis"
author:
  - "Eva Kormann"
  - "Thomas Klebel"
format: html
editor: visual
execute: 
  echo: true
  warning: false
---

```{r}
#| output: false
#| echo: false

library(tidyverse)
library(psych)
library(ggchicklet)
library(patchwork)
library(janitor)
library(hrbrthemes)

source("R/analysis.R")

# Get data
use_targets <- TRUE # Set to false if data is not received by targets pipeline

if (use_targets) {
  
  df <- targets::tar_read(recoded_data)
  var_overview <- targets::tar_read(var_overview)

} else {
  
  library(here)
  data <- here("data", "processed", "preprocessed_data.csv")
  vars <- here("data", "processed", "var_overview.csv")
  df <- read_csv(data)
  var_overview <- read_csv(vars)
}
```

# Comparison between items

## Agreement with statements on Open Science (X38-X52)

### Comparison Plot (2022 only)

```{r}
columns <- paste0("X", 38:52)
plot_agreement_overview(df, var_overview, columns, sort = FALSE,
                        filter = "X64", filter_val = 2022)
```

### Full Statements

```{r}
knitr::kable(var_overview[var_overview$var_id %in% columns,])
```

### Overview Table by Year

```{r}
knitr::kable(table_answers_overview(df, columns, "X64"))
```

## Agreement with statements on research integrity (X15-X23)

Caution: X19 is phrased as an inverted item, while all others are not.

```{r}

columns <- paste0("X", 15:23)
plot_agreement_overview(df, var_overview, columns)

knitr::kable(var_overview[var_overview$var_id %in% columns,])
```

## Frequency of certain practices at own institution (X24-X37)

```{r}
columns <- paste0("X", 24:37)
plot_frequency_overview(df, var_overview, columns)

knitr::kable(var_overview[var_overview$var_id %in% columns,])
```

# Comparison within one item

## Agreement

### Open data

"Experimental data should be published as openly as possible." (X45)

```{r}
plot_agreement(df, var_overview, "X45", group = "X64")

knitr::kable(table_answers(df, "X45", "X64"), format = "html")
```

## Frequency of certain practices at own institution

### Fabrications

"Making up data or facts about a scientific activity, for example, a research experiment." (X26)

```{r}
plot_frequency(df, var_overview, "X26", group = "X8", filter = "X64", filter_val = "2023", sort = TRUE)

knitr::kable(table_answers(df, "X26", group = "X8", filter = "X64", filter_val = "2023"), format = "html")
```

## 
