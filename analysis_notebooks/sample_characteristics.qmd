---
title: "Sample Characteristics"
author:
  - "Eva Kormann"
  - "Thomas Klebel"
format: html
editor: visual
execute: 
  echo: false
---

```{r}
#| output: false
#| warning: false

library(here)
library(tidyverse)
library(sf)
library(fuzzyjoin)
library(psych)
library(ggridges)

options(dplyr.summarise.inform = FALSE)

# Get data
df <- targets::tar_read(recoded_data)
```

## Number of survey respondents

The survey included three waves, with one wave each year from 2021 to 2023. In addition to a broad national survey, participants were also specifically recruited at the four higher education institutions that are partners within the [OPTIMA](https://lpnu.ua/en/optima) project:

-   Lviv Polytechnic National University (LPU)
-   Sumy State University (SumDU)
-   Vasyl' Stus Donetsk National University (DonNU)
-   Lutsk National Technical University (LutskNTU)

```{r}
df$X63 <- factor(df$X63, levels = c("National", "LPU", "SumDU", "DonNU", "LutskNTU"))
knitr::kable(table(df$X63, df$X64), format = "html")


ggplot(df, aes(x = X63, fill = as_factor(X64))) +
  geom_bar(position = "dodge") +
  labs(title = "Number of Survey Respondents by Survey and Year", x = "Survey", y = "Count") +
  theme_minimal() +
  theme(legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5))
```

## Academic role

Participants indicated what they are best described by in terms of academic roles: *"Which of the following best describes you?"*

```{r}
df$X8 <- factor(df$X8, levels = c("student - 1st year", "student - 2nd year", "student - 3rd year", "student - 4th year", "master student", "doctoral student - PhD", "doctoral student - ScD (higher doctorate)", "faculty", "university administrator", "librarian", "other"))
df$X8 <-  fct_na_value_to_level(df$X8)
knitr::kable(table(df$X8, df$X64), format = "html")
```

## Gender

```{r}
knitr::kable(table(df$X9, df$X64), format = "html")
```

## Degree

*"What is the highest completed academic degree you have?"*

```{r}
df$X10 <- factor(df$X10, levels = c("none (still studying)", "bachelor", "master", "PhD", "ScD (higher doctorate)"))
knitr::kable(table(df$X10, df$X64), format = "html")
```

## Work experience

*"How many years have you been working in higher education and/or research?"*

```{r}
df$X11 <- factor(df$X11, levels = c("I have never worked in this sphere", "less than 1 year", "1-5 years", "5-10 years", "more than 10 years"))
knitr::kable(table(df$X11, df$X64), format = "html")
```

## Field/Discipline

*"What is your field of study or work?"*

```{r}
knitr::kable(table(df$X12, df$X64), format = "html")
```

## Publications

*"How many research outputs (articles, monographs, conference papers) have you published in the last 3 years?"*

```{r}
df$X13 <- factor(df$X13, levels = c("0", "1-5", "6-10", "11-20", "21-30", "more than 30"))
knitr::kable(table(df$X13, df$X64), format = "html")
```

## Peer review

*"How many peer reviews of research outputs (articles, monographs, reports) have you written in the last 3 years?"*

```{r}
knitr::kable(table(df$X14, df$X64), format = "html")
```

## Type of institution

*"What type of higher education institution do you study or work at?"*

```{r}
knitr::kable(table(df$X54, df$X64), format = "html")
```

## Location

*"Your higher education institution is located in"*...

In 2022, this question was extended to *"Your higher education institution is located in (this refers to the original location before 02/24/2022)"*. For the 2023 survey, the phrasing of the question was again reduced to the one first employed in 2021.

Spatial data for the country of Ukraine and its Oblasts were retrieved from [GADM](https://gadm.org/index.html) for visualizations.

```{r}
#| include : false

# Location of institution for mapping
locations <- df %>% 
  group_by(X64, X55) %>% 
  summarize(count = n()) %>% 
  pivot_wider(names_from = X64, values_from = count) %>% 
  rename(NAME_1 = X55) %>% 
  mutate(NAME_1 = gsub(" Oblast", "", NAME_1)) %>% 
  mutate(NAME_1 = gsub("Autonomous Republic of ", "", NAME_1))

# Add Sevastopol for completeness
locations[nrow(locations) + 1,] = list("Sevastopol", 0, 0, 0)

map_data <- here("data", "additional", "map", "gadm41_UKR_1.shp")
ukraine_map <- st_read(map_data, quiet = TRUE) %>% 
  filter(!grepl("\\?", NAME_1)) %>%
  st_make_valid(.)


# Join sample and geographical data by fuzzy string matching
map_counts <- stringdist_join(ukraine_map, locations, 
                              by = "NAME_1",
                              mode = "left",
                              method = "jw",
                              max_dist = 99, 
                              distance_col = "dist") %>%
  group_by(NAME_1.x) %>%
  slice_min(order_by = dist, n = 1)


# Create again shapefile out of merged data
map_counts <- st_as_sf(map_counts)
```

```{r}
# Plot number of respondents by region in year 2021
ggplot() +
  geom_sf(data = map_counts, aes(fill = `2021`), color = "white") +
  scale_fill_gradient(low = "white", high = "red", limits = c(0, 2000)) +
  geom_text(data = map_counts,
            aes(label = NAME_1.y,
                x = st_coordinates(st_centroid(geometry))[, "X"],
                y = st_coordinates(st_centroid(geometry))[, "Y"]),
            color = "black", size = 2, check_overlap = FALSE) +
  ggtitle("Respondents by Location in 2021") +
  theme(axis.text = element_blank(),  # Hide axis labels
        axis.ticks = element_blank(), # Hide axis ticks
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5),
        legend.title = element_blank(), # Hide legend title
        panel.grid = element_blank())  # Hide grid lines
```

```{r}
# Plot number of respondents by region in year 2022
ggplot() +
  geom_sf(data = map_counts, aes(fill = `2022`), color = "white") +
  scale_fill_gradient(low = "white", high = "red", limits = c(0, 2000)) +
  geom_text(data = map_counts,
            aes(label = NAME_1.y,
                x = st_coordinates(st_centroid(geometry))[, "X"],
                y = st_coordinates(st_centroid(geometry))[, "Y"]),
            color = "black", size = 2, check_overlap = FALSE) +
   ggtitle("Respondents by Location in 2022") +
  theme(axis.text = element_blank(),  # Hide axis labels
        axis.ticks = element_blank(), # Hide axis ticks
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5),
        legend.title = element_blank(), # Hide legend title
        panel.grid = element_blank())  # Hide grid lines
```

```{r}
# Plot number of respondents by region in year 2023
ggplot() +
  geom_sf(data = map_counts, aes(fill = `2023`), color = "white") +
  scale_fill_gradient(low = "white", high = "red", limits = c(0, 2000)) +
  geom_text(data = map_counts,
            aes(label = NAME_1.y,
                x = st_coordinates(st_centroid(geometry))[, "X"],
                y = st_coordinates(st_centroid(geometry))[, "Y"]),
            color = "black", size = 2, check_overlap = FALSE) +
  ggtitle("Respondents by Location in 2023") +
  theme(axis.text = element_blank(),  # Hide axis labels
        axis.ticks = element_blank(), # Hide axis ticks
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5),
        legend.title = element_blank(), # Hide legend title
        panel.grid = element_blank())  # Hide grid lines
```

## Investigation of Response Times

Time stamps were collected within the survey for start and finish. Total response duration was calculated as the difference between those two time stamps in minutes. These were examined more closely to estimate the risk of part of the sample only responding superficially and therefore very quickly.

First, basic descriptive statistics are examined for total response time. Additionally, a simple boxplot is created.

```{r}
knitr::kable(describe(df$duration), format = "html")
boxplot(df$duration, main = "Boxplot of Total Response Times", ylab = "Duration")
```

Especially the range of response times from 0 to over 5000 minutes (about three and a half days) is interesting. There are some outliers where respondents might have had the survey open for some days before finally submitting it. The survey took a median time of about 9 minutes to complete.

To have a closer look at the distribution of total response times, a histogram is created. Only times ranging from 0 to 30 minutes will be plotted for better visibility (extreme outliers are omitted).

```{r}
hist(df$duration[df$duration >= 0 & df$duration <= 30], breaks = 30,
     main = "Histogram of Total Response Times", xlab = "Duration")
```

Only a small share of respondents finished the survey in less then 3 minutes. The peak in the distribution can be seen between 7 and 8 minutes.

Since different groups in the academic context might vary in their familiarity with the topic, they might differ in their response times. To detect possible pronounced differences, distribution of total response time is plotted separately by academic role indicated (again limiting the range of visualized values from 0 to 30).

```{r}
#| warning: false

ggplot(df, aes(x = duration, y = X8)) +
  stat_density_ridges(quantile_lines = TRUE, alpha = 0.7, fill = "lightblue",
                      vline_color = "white") +
  xlim(0, 30) +
  labs(x = "Duration",
       y = "Academic Role",
       title = "Distribution of Total Response Times by Academic Role") +
  scale_y_discrete(labels = c("university administrator" = "administrator",
                              "doctoral student - ScD (higher doctorate)" = "doctoral student - ScD")) +
  theme(
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "lightgray"),
    panel.grid.minor = element_line(color = "white")
  )
```

While students have a lower median than, e.g., faculty, there are no major differences in distributions upon closer inspection. The groups do not appear substantially different in their response times.

## Clarity

At the end of the survey, one question asked respondents whether they agreed to following statement: *"All the questions in this questionnaire were clear to me."*

```{r}
df$X53 <-  fct_na_value_to_level(df$X53)
knitr::kable(table(df$X53, df$X64), format = "html")


ggplot(df, aes(x = X53, fill = as_factor(X64))) +
  geom_bar(position = "dodge") +
  labs(title = "Clarity of Survey Questions by Year", x = "Clarity", y = "Count") +
  theme_minimal() +
  theme(legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5))
```

While the survey questions were clear to the large majority of respondents, there is still a considerable number of people disagreeing on this statement.

```{r}
#| warning: false

ggplot(df, aes(x = duration, y = X53)) +
  stat_density_ridges(quantile_lines = TRUE, alpha = 0.7, fill = "orange",
                      vline_color = "white") +
  xlim(0, 30) +
  labs(x = "Duration",
       y = "Clarity of Questions",
       title = "Distribution of Total Response Times by Clarity Questions") +
  theme(
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "lightgray"),
    panel.grid.minor = element_line(color = "white")
  )
```

When investigated in relation to response time, the most notable deviation in distribution can be seen in those not answering the clarity question or answering "don't know" to this question. These respondents tended to finish the survey more quickly.

```{r}

# Calculate respondents indicating low clarity and responding fast
subset_df <- subset(df, duration < 3 & X53 %in% c("strongly disagree", "rather disagree", "NA", "don't know"))

n_fast <- nrow(subset_df)
```

However, the number of respondents who took less than three minutes for the survey and indicated low clarity (or did not answer the clarity question) only lies at `r n_fast`.
