<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eva Kormann">
<meta name="author" content="Thomas Klebel">

<title>Survey Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="survey_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="survey_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="survey_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="survey_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="survey_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="survey_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="survey_analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="survey_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="survey_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="survey_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Survey Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Eva Kormann </p>
             <p>Thomas Klebel </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="comparison-between-items" class="level1">
<h1>Comparison between items</h1>
<section id="agreement-x38-x52-open-science-focus" class="level2">
<h2 class="anchored" data-anchor-id="agreement-x38-x52-open-science-focus">Agreement X38-X52 (open science focus)</h2>
<p>The overviews are so far produced by the order of items in the survey. However, we plan to rearrange the items more by related topics and create overviews that way.</p>
<section id="comparison-plot" class="level3">
<h3 class="anchored" data-anchor-id="comparison-plot">Comparison Plot</h3>
<p>This plot compares the selected answer categories across different agreement items and sorts them based on how many people agree. For better visualization, the labels are (for now) replaced by the short variable id. It might make sense to include only response from one year in one such plot (because otherwise some respondents would appear multiple times, while others won’t). The option to filter for a specific year is already implemented.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>columns <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">38</span><span class="sc">:</span><span class="dv">52</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_agreement_overview</span>(df, var_overview, columns, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="survey_analysis_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="full-statements" class="level3">
<h3 class="anchored" data-anchor-id="full-statements">Full Statements</h3>
<p>To look up the full statements that are referred to by the variable ids, we derive them here from our variable overview.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(var_overview[var_overview<span class="sc">$</span>var_id <span class="sc">%in%</span> columns, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 95%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">var_id</th>
<th style="text-align: left;">var_full</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">X38</td>
<td style="text-align: left;">Research results should be in open access, i.e.&nbsp;freely available to the academic community and the general public.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X39</td>
<td style="text-align: left;">Research papers should be openly available even before the official peer review process, i.e.&nbsp;before a thorough review of their content.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X40</td>
<td style="text-align: left;">Authors should retain intellectual property rights to their published works, even at the cost of giving up some opportunities for free publication</td>
</tr>
<tr class="even">
<td style="text-align: left;">X41</td>
<td style="text-align: left;">Scholars should explain the results of their research to the general public in an understandable way.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X42</td>
<td style="text-align: left;">Researchers should publish author’s versions of manuscripts on open online resources such as Zenodo, institutional repositories, etc.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X43</td>
<td style="text-align: left;">Researchers should invest time in describing their experimental data with appropriate metadata so that the data can be easily found and reused.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X44</td>
<td style="text-align: left;">Time should be invested in describing research methodology, tools, and experimental results in detail so that other researchers can reproduce them.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X45</td>
<td style="text-align: left;">Experimental data should be published as openly as possible.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X46</td>
<td style="text-align: left;">If software development is part of a research project, the source code should be published alongside the relevant scientific papers.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X47</td>
<td style="text-align: left;">Researchers should always strive to ensure that their research serves a broad public purpose, regardless of the field of science in which they work.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X48</td>
<td style="text-align: left;">The names of peer reviewers of research papers should be made public, regardless of whether their conclusion is positive or negative.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X49</td>
<td style="text-align: left;">The texts of positive and negative peer reviews of research papers should be published alongside these papers.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X50</td>
<td style="text-align: left;">Authors of research papers and peer reviewers should be able to communicate directly without intermediaries.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X51</td>
<td style="text-align: left;">Higher education institutions should provide open access to their educational resources (textbooks, manuals, various digital tools, etc.) for everyone.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X52</td>
<td style="text-align: left;">I can explain what “open science” is.</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="agreement-x15-x23-research-integrity-focus" class="level2">
<h2 class="anchored" data-anchor-id="agreement-x15-x23-research-integrity-focus">Agreement X15-X23 (research integrity focus)</h2>
<section id="comparison-plot-1" class="level3">
<h3 class="anchored" data-anchor-id="comparison-plot-1">Comparison Plot</h3>
<p>Caution: X19 is phrased as an inverted item, while all others are not. This needs to be considered for interpretation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>columns <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">23</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_agreement_overview</span>(df, var_overview, columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="survey_analysis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="full-statements-1" class="level3">
<h3 class="anchored" data-anchor-id="full-statements-1">Full Statements</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(var_overview[var_overview<span class="sc">$</span>var_id <span class="sc">%in%</span> columns, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 94%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">var_id</th>
<th style="text-align: left;">var_full</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">X15</td>
<td style="text-align: left;">Overall, the processes at my higher education institution are organised in a clear and transparent manner</td>
</tr>
<tr class="even">
<td style="text-align: left;">X16</td>
<td style="text-align: left;">The quality of educational services at my higher education institution is high</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X17</td>
<td style="text-align: left;">Researchers should publish all research results (both positive and negative)</td>
</tr>
<tr class="even">
<td style="text-align: left;">X18</td>
<td style="text-align: left;">All co-authors are fully responsible for the content of the publication, regardless of the amount of their contribution</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X19</td>
<td style="text-align: left;">Changes to experimental data after the end of the experiment are acceptable</td>
</tr>
<tr class="even">
<td style="text-align: left;">X20</td>
<td style="text-align: left;">It is necessary to indicate the authorship of all those who have contributed to the research without exception</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X21</td>
<td style="text-align: left;">Researchers should report any conflicts of interest when publishing research results and applying for funding</td>
</tr>
<tr class="even">
<td style="text-align: left;">X22</td>
<td style="text-align: left;">Students should openly publish the full texts of their diploma theses</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X23</td>
<td style="text-align: left;">Students must understand what constitutes inappropriate academic behavior and report it to the appropriate authorities</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="frequency-of-certain-practices-at-own-institution-x24-x37" class="level2">
<h2 class="anchored" data-anchor-id="frequency-of-certain-practices-at-own-institution-x24-x37">Frequency of certain practices at own institution (X24-X37)</h2>
<section id="comparison-plot-2" class="level3">
<h3 class="anchored" data-anchor-id="comparison-plot-2">Comparison Plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>columns <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">24</span><span class="sc">:</span><span class="dv">37</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_frequency_overview</span>(df, var_overview, columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="survey_analysis_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="full-statements-2" class="level3">
<h3 class="anchored" data-anchor-id="full-statements-2">Full Statements</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(var_overview[var_overview<span class="sc">$</span>var_id <span class="sc">%in%</span> columns, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 96%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">var_id</th>
<th style="text-align: left;">var_full</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">X24</td>
<td style="text-align: left;">Using other author’s published papers and ideas without proper reference to the original source.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X25</td>
<td style="text-align: left;">The author uses his own previous publications as part of a new work without proper acknowledgment or citation of the original.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X26</td>
<td style="text-align: left;">Making up data or facts about a scientific activity, for example, a research experiment.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X27</td>
<td style="text-align: left;">Selective citations to support one’s conclusions or to please editors, reviewers, colleagues, etc.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X28</td>
<td style="text-align: left;">The author passes off other people’s academic achievements as his own.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X29</td>
<td style="text-align: left;">A person attributes to himself or herself the authorship of a work (assignment, article, etc.) that he or she did not actually perform, but arranged for others to perform it for a fee or in another way.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X30</td>
<td style="text-align: left;">Students help each other during exams or tests.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X31</td>
<td style="text-align: left;">Students use cheat sheets, smartphones, or other means of cheating during exams or tests.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X32</td>
<td style="text-align: left;">Students and teachers use unauthorized software (so-called “pirated software”).</td>
</tr>
<tr class="even">
<td style="text-align: left;">X33</td>
<td style="text-align: left;">Incitement to violate academic integrity.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X34</td>
<td style="text-align: left;">The administration of the institution tolerates cases of academic dishonesty.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X35</td>
<td style="text-align: left;">Falsely accusing a student or employee of misconduct or other violations.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X36</td>
<td style="text-align: left;">Abuse of official position or authority to encourage academic dishonesty.</td>
</tr>
<tr class="even">
<td style="text-align: left;">X37</td>
<td style="text-align: left;">The university administration accuses and punishes whistleblowers of academic integrity violations.</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="comparison-within-one-item" class="level1">
<h1>Comparison within one item</h1>
<section id="agreement" class="level2">
<h2 class="anchored" data-anchor-id="agreement">Agreement</h2>
<section id="open-data" class="level3">
<h3 class="anchored" data-anchor-id="open-data">Open data</h3>
<p>“Experimental data should be published as openly as possible.” (X45)</p>
<p>Data here is grouped by the survey year, therefore allowing quick visual comparisons. There is a plan to have more specific visualizations for developments over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_agreement</span>(df, var_overview, <span class="st">"X45"</span>, <span class="at">group =</span> <span class="st">"X64"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="survey_analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="frequency-of-certain-practices-at-own-institution" class="level2">
<h2 class="anchored" data-anchor-id="frequency-of-certain-practices-at-own-institution">Frequency of certain practices at own institution</h2>
<section id="fabrications" class="level3">
<h3 class="anchored" data-anchor-id="fabrications">Fabrications</h3>
<p>“Making up data or facts about a scientific activity, for example, a research experiment.” (X26)</p>
<p>Data here is filtered for the year 2023 and grouped by academic role (which is a variable that could benefit from merging some categories). The groups are sorted by the frequency they estimate. However, we could sort the groups also in some other way as desired.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_frequency</span>(df, var_overview, <span class="st">"X26"</span>, <span class="at">group =</span> <span class="st">"X8"</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">filter =</span> <span class="st">"X64"</span>, <span class="at">filter_val =</span> <span class="st">"2023"</span>, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="survey_analysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<p>Additionally to these plots, we can also produce large overview tables that would allow to investigate certain items, groups or categories more closely. However, these were left out for now due to their size. Visualizations will also be adapted and optimized (e.g., labelling of axes), but some issues at the moment are also caused by rendering that will be solved later.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>