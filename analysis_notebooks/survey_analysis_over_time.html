<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eva Kormann">
<meta name="author" content="Thomas Klebel">

<title>Survey Analysis - plots over time</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="survey_analysis_over_time_files/libs/clipboard/clipboard.min.js"></script>
<script src="survey_analysis_over_time_files/libs/quarto-html/quarto.js"></script>
<script src="survey_analysis_over_time_files/libs/quarto-html/popper.min.js"></script>
<script src="survey_analysis_over_time_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="survey_analysis_over_time_files/libs/quarto-html/anchor.min.js"></script>
<link href="survey_analysis_over_time_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="survey_analysis_over_time_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="survey_analysis_over_time_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="survey_analysis_over_time_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="survey_analysis_over_time_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Survey Analysis - plots over time</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Eva Kormann </p>
             <p>Thomas Klebel </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<style type="text/css">
/* Make tables scroll */ 
  
  .scroll {
    max-height: 500px;
    overflow-y: scroll;
  }
</style>
</div>
<section id="development-over-time" class="level1">
<h1>Development over Time</h1>
<p>Since the survey was conducted in three separate waves (2021, 2022, 2023), responses are also compared between those years. Similar to the overview plots where “don’t know” and missing responses were separated out before calculating proportions of certain response categories, these are also filtered out here. Percentages therefore refer to all respondents that chose one of the response categories presented in the figure.</p>
<section id="research" class="level2">
<h2 class="anchored" data-anchor-id="research">Research</h2>
<section id="open-science" class="level3">
<h3 class="anchored" data-anchor-id="open-science">Open Science</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time</span>(df, var_overview, os, <span class="at">type =</span> <span class="st">"agreement"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_analysis_over_time_files/figure-html/os_development-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$data
# A tibble: 120 × 5
   variable                                         value  year     n proportion
   &lt;chr&gt;                                            &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;     
 1 Authors of research papers and peer reviewers s… stro…  2021  2717 36.31%    
 2 Authors of research papers and peer reviewers s… stro…  2022  2952 38.59%    
 3 Authors of research papers and peer reviewers s… stro…  2023  1974 39.07%    
 4 Authors of research papers and peer reviewers s… rath…  2021  2943 39.33%    
 5 Authors of research papers and peer reviewers s… rath…  2022  3167 41.40%    
 6 Authors of research papers and peer reviewers s… rath…  2023  1849 36.59%    
 7 Authors of research papers and peer reviewers s… rath…  2021  1121 14.98%    
 8 Authors of research papers and peer reviewers s… rath…  2022  1038 13.57%    
 9 Authors of research papers and peer reviewers s… rath…  2023   752 14.88%    
10 Authors of research papers and peer reviewers s… stro…  2021   702 9.38%     
# ℹ 110 more rows</code></pre>
</div>
</div>
</section>
<section id="reporting-and-academic-integrity" class="level3">
<h3 class="anchored" data-anchor-id="reporting-and-academic-integrity">Reporting and Academic Integrity</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time</span>(df, var_overview, raia, <span class="at">type =</span> <span class="st">"agreement"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_analysis_over_time_files/figure-html/raia_development-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$data
# A tibble: 108 × 5
   variable                                         value  year     n proportion
   &lt;chr&gt;                                            &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;     
 1 All co-authors are fully responsible for the co… stro…  2021  5671 63.83%    
 2 All co-authors are fully responsible for the co… stro…  2022  5708 62.17%    
 3 All co-authors are fully responsible for the co… stro…  2023  3756 66.07%    
 4 All co-authors are fully responsible for the co… rath…  2021  2387 26.87%    
 5 All co-authors are fully responsible for the co… rath…  2022  2730 29.73%    
 6 All co-authors are fully responsible for the co… rath…  2023  1440 25.33%    
 7 All co-authors are fully responsible for the co… rath…  2021   668 7.52%     
 8 All co-authors are fully responsible for the co… rath…  2022   612 6.67%     
 9 All co-authors are fully responsible for the co… rath…  2023   385 6.77%     
10 All co-authors are fully responsible for the co… stro…  2021   158 1.78%     
# ℹ 98 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time</span>(df, var_overview, raif, <span class="at">type =</span> <span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_analysis_over_time_files/figure-html/raif_development-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$data
# A tibble: 90 × 5
   variable                                         value  year     n proportion
   &lt;chr&gt;                                            &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;     
 1 A person attributes to himself or herself the a… very…  2021   291 5.15%     
 2 A person attributes to himself or herself the a… very…  2022   307 5.30%     
 3 A person attributes to himself or herself the a… very…  2023   253 6.71%     
 4 A person attributes to himself or herself the a… freq…  2021   531 9.39%     
 5 A person attributes to himself or herself the a… freq…  2022   453 7.82%     
 6 A person attributes to himself or herself the a… freq…  2023   392 10.40%    
 7 A person attributes to himself or herself the a… some…  2021  1145 20.25%    
 8 A person attributes to himself or herself the a… some…  2022  1044 18.02%    
 9 A person attributes to himself or herself the a… some…  2023   902 23.93%    
10 A person attributes to himself or herself the a… rare…  2021  1101 19.48%    
# ℹ 80 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="education" class="level2">
<h2 class="anchored" data-anchor-id="education">Education</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time</span>(df, var_overview, edua, <span class="at">type =</span> <span class="st">"agreement"</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">var_wrap =</span> <span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_analysis_over_time_files/figure-html/edua_development-1.png" class="img-fluid figure-img" width="2400"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$data
# A tibble: 48 × 5
   variable                                         value  year     n proportion
   &lt;chr&gt;                                            &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;     
 1 Higher education institutions should provide op… stro…  2021  4026 49.14%    
 2 Higher education institutions should provide op… stro…  2022  4418 52.29%    
 3 Higher education institutions should provide op… stro…  2023  2631 49.30%    
 4 Higher education institutions should provide op… rath…  2021  2415 29.48%    
 5 Higher education institutions should provide op… rath…  2022  2464 29.16%    
 6 Higher education institutions should provide op… rath…  2023  1589 29.77%    
 7 Higher education institutions should provide op… rath…  2021  1206 14.72%    
 8 Higher education institutions should provide op… rath…  2022  1118 13.23%    
 9 Higher education institutions should provide op… rath…  2023   735 13.77%    
10 Higher education institutions should provide op… stro…  2021   546 6.66%     
# ℹ 38 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time</span>(df, var_overview, eduf, <span class="at">type =</span> <span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_analysis_over_time_files/figure-html/eduf_development-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$data
# A tibble: 45 × 5
   variable                                         value  year     n proportion
   &lt;chr&gt;                                            &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;     
 1 "Students and teachers use unauthorized softwar… very…  2021   510 8.81%     
 2 "Students and teachers use unauthorized softwar… very…  2022   628 10.31%    
 3 "Students and teachers use unauthorized softwar… very…  2023   433 10.79%    
 4 "Students and teachers use unauthorized softwar… freq…  2021   702 12.12%    
 5 "Students and teachers use unauthorized softwar… freq…  2022   695 11.41%    
 6 "Students and teachers use unauthorized softwar… freq…  2023   555 13.83%    
 7 "Students and teachers use unauthorized softwar… some…  2021   977 16.87%    
 8 "Students and teachers use unauthorized softwar… some…  2022   964 15.83%    
 9 "Students and teachers use unauthorized softwar… some…  2023   808 20.13%    
10 "Students and teachers use unauthorized softwar… rare…  2021   822 14.19%    
# ℹ 35 more rows</code></pre>
</div>
</div>
</section>
<section id="institutionadministration" class="level2">
<h2 class="anchored" data-anchor-id="institutionadministration">Institution/Administration</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time</span>(df, var_overview, adm, <span class="at">type =</span> <span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_analysis_over_time_files/figure-html/adm_development-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$data
# A tibble: 75 × 5
   variable                                         value  year     n proportion
   &lt;chr&gt;                                            &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;     
 1 Abuse of official position or authority to enco… very…  2021   200 3.18%     
 2 Abuse of official position or authority to enco… very…  2022   218 3.42%     
 3 Abuse of official position or authority to enco… very…  2023   210 5.06%     
 4 Abuse of official position or authority to enco… freq…  2021   244 3.88%     
 5 Abuse of official position or authority to enco… freq…  2022   274 4.30%     
 6 Abuse of official position or authority to enco… freq…  2023   279 6.72%     
 7 Abuse of official position or authority to enco… some…  2021   605 9.62%     
 8 Abuse of official position or authority to enco… some…  2022   668 10.49%    
 9 Abuse of official position or authority to enco… some…  2023   552 13.30%    
10 Abuse of official position or authority to enco… rare…  2021   784 12.47%    
# ℹ 65 more rows</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>